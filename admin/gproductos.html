<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Productos</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="../css/styles.css">
</head>
<body>
  <!-- Navbar -->
<div id="navbar-container">
  <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold text-primary" href="dashboard.html">LovelyY5 - Intranet</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
          <li class="nav-item"><a class="nav-link" href="gproductos.html">Gestión de Productos</a></li>
          <li class="nav-item"><a class="nav-link" href="pedidos.html">Pedidos</a></li>
          <li class="nav-item"><a class="nav-link" href="mensajes.html">Mensajes</a></li>
          <li class="nav-item"><a class="nav-link" href="usuarios.html">Usuarios</a></li>
          <li class="nav-item"><a class="nav-link" href="index.html">Cerrar Sesión</a></li>
        </ul>
      </div>
    </div>
  </nav>
</div>

<div class="container py-5">
  <h1>Gestión de Productos</h1>
  <button class="btn btn-success mb-3" id="btn-nuevo-producto">Añadir Producto</button>

  <div id="form-producto-container" class="card p-3 mb-4 d-none">
    <h5 id="form-titulo">Añadir Producto</h5>
    <div class="mb-2"><input type="text" class="form-control" id="producto-nombre" placeholder="Nombre"></div>
    <div class="mb-2"><input type="text" class="form-control" id="producto-codigo" placeholder="Código"></div>
    <div class="mb-2"><input type="number" class="form-control" id="producto-precio" placeholder="Precio"></div>
    <div class="mb-2"><input type="number" class="form-control" id="producto-stock" placeholder="Stock"></div>
    <div class="mb-2"><input type="text" class="form-control" id="producto-categoria" placeholder="Categoría"></div>
    <div class="mb-2"><input type="text" class="form-control" id="producto-imagenes" placeholder="Imagenes (separadas por coma)"></div>
    <button class="btn btn-primary" id="guardar-producto">Guardar</button>
    <button class="btn btn-secondary" id="cancelar-producto">Cancelar</button>
  </div>

  <div id="productos-list" class="row g-3"></div>
</div>
<!-- Footer -->
  <footer class="text-center py-4 text-white" style="background-color: #FFACCA;">
    <div class="mb-2">
      <a href="#" class="mx-2"><img src="img/instagram.svg" style="width:28px;"></a>
      <a href="#" class="mx-2"><img src="img/facebook.svg" style="width:28px;"></a>
      <a href="#" class="mx-2"><img src="img/paypal.svg" style="width:28px;"></a>
    </div>
    <p class="mb-0">&copy; 2025 LovelyY5 - Todos los derechos reservados</p>
  </footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const productosList = document.getElementById('productos-list');
  const formContainer = document.getElementById('form-producto-container');
  const formTitulo = document.getElementById('form-titulo');

  let productos = JSON.parse(localStorage.getItem('productos')) || [];
  let editIndex = null;

  function renderProductos(){
    productosList.innerHTML = '';
    if(productos.length === 0){
      productosList.innerHTML = '<p>No hay productos añadidos.</p>';
      return;
    }
    productos.forEach((p, index) => {
      const div = document.createElement('div');
      div.className = 'col-md-4';
      div.innerHTML = `<div class="card p-2">
        <img src="img/${p.imagenes?.[0]||'default.png'}" class="card-img-top mb-2">
        <strong>${p.nombre}</strong> - $${p.precio} - Stock: ${p.stock}<br>
        <button class="btn btn-sm btn-primary btn-editar">Editar</button>
        <button class="btn btn-sm btn-danger btn-borrar">Borrar</button>
      </div>`;
      productosList.appendChild(div);

      div.querySelector('.btn-editar').addEventListener('click', () => {
        editIndex = index;
        formTitulo.textContent = 'Editar Producto';
        formContainer.classList.remove('d-none');
        document.getElementById('producto-nombre').value = p.nombre;
        document.getElementById('producto-codigo').value = p.codigo;
        document.getElementById('producto-precio').value = p.precio;
        document.getElementById('producto-stock').value = p.stock;
        document.getElementById('producto-categoria').value = p.categoria;
        document.getElementById('producto-imagenes').value = p.imagenes?.join(',') || '';
      });

      div.querySelector('.btn-borrar').addEventListener('click', () => {
        if(confirm(`¿Deseas borrar el producto ${p.nombre}?`)){
          productos.splice(index,1);
          localStorage.setItem('productos', JSON.stringify(productos));
          renderProductos();
        }
      });
    });
  }

  document.getElementById('btn-nuevo-producto').addEventListener('click', () => {
    editIndex = null;
    formTitulo.textContent = 'Añadir Producto';
    formContainer.classList.remove('d-none');
    document.getElementById('producto-nombre').value = '';
    document.getElementById('producto-codigo').value = '';
    document.getElementById('producto-precio').value = '';
    document.getElementById('producto-stock').value = '';
    document.getElementById('producto-categoria').value = '';
    document.getElementById('producto-imagenes').value = '';
  });

  document.getElementById('cancelar-producto').addEventListener('click', () => {
    formContainer.classList.add('d-none');
  });

  document.getElementById('guardar-producto').addEventListener('click', () => {
    const p = {
      nombre: document.getElementById('producto-nombre').value,
      codigo: document.getElementById('producto-codigo').value,
      precio: parseFloat(document.getElementById('producto-precio').value) || 0,
      stock: parseInt(document.getElementById('producto-stock').value) || 0,
      categoria: document.getElementById('producto-categoria').value,
      imagenes: document.getElementById('producto-imagenes').value.split(',').map(i => i.trim())
    };
    if(editIndex !== null){
      productos[editIndex] = p;
    } else {
      productos.push(p);
    }
    localStorage.setItem('productos', JSON.stringify(productos));
    formContainer.classList.add('d-none');
    renderProductos();
  });

  renderProductos();

  // Cerrar sesión
  document.getElementById('cerrar-sesion').addEventListener('click', () => {
    if(confirm('¿Deseas cerrar sesión?')) {
      localStorage.removeItem('adminLogin');
      window.location.href = 'index.html';
    }
  });
});
</script>
</body>
</html>
