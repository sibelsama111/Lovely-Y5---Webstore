<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Producto Detalle - LovelyY5</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="icon" href="img/favicon.png">
  <style>
    .zoom-img {
      transition: transform 0.3s ease;
      cursor: zoom-in;
    }
    .zoom-img:hover {
      transform: scale(1.5);
    }
    .carousel-item img { max-height: 400px; object-fit: cover; }
    #btn-carrito-flotante {
      position: fixed;
      bottom: 32px;
      right: 32px;
      z-index: 9999;
      background: #FFACCA;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    #btn-carrito-flotante .carrito-cantidad {
      position: absolute;
      top: 4px;
      right: 4px;
      background: #fff;
      color: #000;
      border-radius: 50%;
      font-size: 0.8rem;
      padding: 2px 6px;
    }
  </style>
</head>
<body>
<!-- Navbar -->
  <div id="navbar-container">
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
      <div class="container">
        <h1 class="site-logo"></h1>
          <a href="index.html" class="title-button">
            <img src="img/favicon.png" alt="Lovely Y5 Logo" class="title-icon">
            <span>Lovely Y5</span>
          </a>
        </h1>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item"><a class="nav-link active" href="index.html">Inicio</a></li>
            <li class="nav-item"><a class="nav-link" href="productos.html">Productos</a></li>
            <li class="nav-item"><a class="nav-link" href="juego.html">Juego de la Suerte</a></li>
            <li class="nav-item"><a class="nav-link" href="servicio-tecnico.html">Servicio Tecnico</a></li>
            <li class="nav-item"><a class="nav-link" href="contacto.html">Contacto</a></li>
            <li class="nav-item"><a class="nav-link" href="login.html">Login</a></li>
            <li class="nav-item"><a class="nav-link" href="intranet.html">Intranet</a></li>
          </ul>
        </div>
      </div>
    </nav>
  </div>

  <div class="container py-5" id="producto-detalle"></div>

  <!-- Footer -->
  <footer class="text-center py-4 text-white" style="background-color: #FFACCA;">
    <div class="mb-2">
      <a href="https://www.instagram.com/lovely.y5.tech/" target="_blank" rel="noopener" class="mx-2" title="Instagram">
        <img src="img/instagram.svg" alt="Instagram" style="width:28px;vertical-align:middle;">
      </a>
      <a href="https://facebook.com/profile.php?id=61576634015335" target="_blank" rel="noopener" class="mx-2" title="Facebook">
        <img src="img/facebook.svg" alt="Facebook" style="width:28px;vertical-align:middle;">
      </a>
      <a href="https://www.paypal.com/paypalme/sibelsama" target="_blank" rel="noopener" class="mx-2" title="PayPal">
        <img src="img/paypal.svg" alt="PayPal" style="width:28px;vertical-align:middle;">
      </a>
    </div>
    <p class="mb-0">&copy; 2025 LovelyY5 - Todos los derechos reservados</p>
  </footer>

  <button id="btn-carrito-flotante" type="button">
    ðŸ›’ <span class="carrito-cantidad"></span>
  </button>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/index.js"></script>
  <script src="js/carrito.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const index = parseInt(params.get('id'), 10);

      fetch('data/ProductosDisponibles.json')
        .then(res => res.json())
        .then(productos => {
          if (!Array.isArray(productos)) {
            throw new Error('Productos no es arreglo');
          }
          const producto = productos[index];
          if (!producto) {
            document.getElementById('producto-detalle').innerHTML = '<p class="text-center">Producto no encontrado</p>';
            return;
          }

          const cont = document.getElementById('producto-detalle');
          const imagenes = (producto.imagenes || []).map(img => {
            return img
              ? (img.startsWith('http') ? img : 'img/' + img)
              : 'img/default.png';
          });

          // construir el carousel de imÃ¡genes
          let carouselInnerHTML = imagenes.map((img, i) => `
            <div class="carousel-item ${i === 0 ? 'active' : ''}">
              <img src="${img}" class="d-block w-100" alt="${producto.nombre}">
            </div>
          `).join('');

          // solo mostrar controles de carousel si hay mÃ¡s de una imagen
          let controlesHTML = '';
          if (imagenes.length > 1) {
            controlesHTML = `
              <button class="carousel-control-prev" type="button" data-bs-target="#carouselProducto" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carouselProducto" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
              </button>
            `;
          }

          cont.innerHTML = `
            <div class="row">
              <div class="col-md-6">
                <div id="carouselProducto" class="carousel slide" data-bs-ride="carousel">
                  <div class="carousel-inner">
                    ${carouselInnerHTML}
                  </div>
                  ${controlesHTML}
                </div>
              </div>
              <div class="col-md-6">
                <h2>${producto.nombre}</h2>
                <p>${producto.descripcion || ''}</p>
                <p class="specs">${producto.specs || ''}</p>
                <p><strong>Precio: </strong>$${producto.precio}</p>
                <p><strong>Stock: </strong>${producto.stock || 0}</p>
                <div class="mb-3">
                  <label for="cantidad" class="form-label">Cantidad</label>
                  <input id="cantidad" type="number" min="1" value="1" class="form-control" style="max-width:120px;">
                </div>
                <button id="btn-agregar" class="btn btn-success">Agregar al carrito</button>
              </div>
            </div>
          `;

          document.getElementById('btn-agregar').addEventListener('click', () => {
            const cantidadInput = document.getElementById('cantidad');
            const cantidad = Math.max(1, parseInt(cantidadInput.value, 10) || 1);
            agregarAlCarrito({
              id: producto.codigo || index,
              nombre: producto.nombre,
              descripcion: producto.descripcion,
              precio: parseFloat(producto.precio) || 0,
              imagen: imagenes[0] || 'img/default.png',
              stock: parseInt(producto.stock) || 0,
              cantidad
            });
            alert(`${producto.nombre} agregado al carrito`);
          });

        })
        .catch(err => {
          console.error(err);
          document.getElementById('producto-detalle').innerHTML = '<p class="text-center text-danger">No se pudo cargar el producto.</p>';
        });

      // carrito flotante redirige
      document.getElementById('btn-carrito-flotante').addEventListener('click', () => {
        window.location.href = 'carrito.html';
      });

      // actualizar burbuja del carrito
      actualizarCarrito(); // de tu carrito.js

    }); // end DOMContentLoaded
  </script>
</body>
</html>
